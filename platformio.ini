; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[platformio]
default_envs = 
	keeper-esp32-s3-devkitc
	pot-esp32-s3-devkitc
workspace_dir = firmware-pio/.pio
include_dir = firmware-pio/include
src_dir = firmware-pio/src
lib_dir = firmware-pio/lib
data_dir = firmware-pio/data
test_dir = firmware-pio/test
boards_dir = firmware-pio/boards
monitor_dir = firmware-pio/monitor
shared_dir = firmware-pio/shared

[shared]
build_flags_keeper = 
	-D CONFIG_APP_NAME=\"keeper\"
	-D CONFIG_APP_KIND_KEEPER=1
	-D CONFIG_SENSORS_DHT21_PIN=10
build_flags_pot = 
	-D CONFIG_APP_NAME=\"pot\"
	-D CONFIG_APP_KIND_POT=1
	-D CONFIG_SENSORS_MOISTURE_PIN=15
	-D CONFIG_SENSORS_PH_PIN=20

[env]
lib_deps = 
	beegee-tokyo/DHT sensor library for ESPx@1.19.0
	https://github.com/PaulStoffregen/OneWire.git@2.3.8
	https://github.com/arduino-libraries/ArduinoMDNS.git#875d963
	https://github.com/arduino-libraries/NTPClient.git#fab3f49
	https://github.com/arduino-libraries/ArduinoMqttClient.git#0a07062
	https://github.com/contrem/arduino-timer.git#2adf6b1
	bblanchon/ArduinoJson@7.4.1
build_flags = 
	-D CONFIG_INITIAL_BOOT_DELAY_SECONDS=3
	-D CONFIG_SENSORS_READ_PERIOD_SECONDS=300
	-D CONFIG_DEVICE_CERTIFICATE_VALIDITY_YEARS=3
	-D CONFIG_SNTP_SERVER_ADDRESS=\"uk.pool.ntp.org\"
	-D CONFIG_SNTP_SERVER_PORT=123
	-D CONFIG_AZURE_IOT_DPS_HOSTNAME=\"global.azure-devices-provisioning.net\"
	-D CONFIG_AZURE_IOT_DPS_ID_SCOPE=\"0ne00F7ADA0\"

	; -D MQTT_CLIENT_DEBUG=1

[env:esp32-s3-devkitc]
platform = https://github.com/pioarduino/platform-espressif32.git#54.03.20
framework = arduino
board = esp32-s3-devkitc-1-n32r8v
build_flags = 
	; For boards with two ports, these allow use of the USB/JTAG port which has less noise
	; or funny characters but may need special/official drivers for it.
	-D ARDUINO_USB_MODE=1
	-D ARDUINO_USB_CDC_ON_BOOT=1

	; ; enable scanning for networks
	; -D CONFIG_WIFI_SCAN_NETWORKS=1

	; ; open network
	; -D CONFIG_WIFI_SSID=\"ASK4\ Wireless\"

	; ; personal network (PSK)
	; -D CONFIG_WIFI_SSID=\"MaxwellsiPhone\"
	; -D CONFIG_WIFI_PASSPHRASE=\"<password>\"

	; enterprise network (EAP-PEAP-MSCHAPV2)
	-D CONFIG_WIFI_SSID=\"eduroam\"
	-D CONFIG_WIFI_ENTERPRISE_USERNAME=\"[username]@ljmu.ac.uk\"
	-D CONFIG_WIFI_ENTERPRISE_PASSWORD=\"[password]\"

	; ; enterprise network (EAP-PEAP-MSCHAPV2 with spaces)
	; -D CONFIG_WIFI_SSID=\"ASK4\ Wireless\ (802.1x)\"
	; -D CONFIG_WIFI_ENTERPRISE_USERNAME=\"[username]\"
	; -D CONFIG_WIFI_ENTERPRISE_PASSWORD=\"[password]\"
extra_scripts = 
	pre:firmware-pio/scripts/version.py

[env:keeper-esp32-s3-devkitc]
extends = env:esp32-s3-devkitc
build_flags = 
	${env.build_flags}
	${shared.build_flags_keeper}
	${env:esp32-s3-devkitc.build_flags}

[env:pot-esp32-s3-devkitc]
extends = env:esp32-s3-devkitc
build_flags = 
	${env.build_flags}
	${shared.build_flags_pot}
	${env:esp32-s3-devkitc.build_flags}
